humhub.module("calendar.participation.Form",function(s,t,r){const i=t("ui.widget").Widget,o=t("ui.loader"),c=t("client"),e=t("ui.status"),a=t("calendar");t=i.extend();t.prototype.init=function(){var i=this;this.saveButton=r("#calendar-entry-participation-button-save"),this.nextButton=r("#calendar-entry-participation-button-next"),this.backButton=r("#calendar-entry-participation-button-back"),this.tabSettings=r("#calendar-entry-participation-tabs li:first"),this.tabParticipants=r("#calendar-entry-participation-tabs li:last"),this.isNewRecord=this.backButton.length,this.isNewRecord&&r("#calendar-entry-participation-tabs li a").click(function(){var t;1<r("#calendar-entry-participation-tabs li:visible").length&&(t=0===r(this).closest("li").index(),i.saveButton.toggle(!t),i.nextButton.toggle(t))})},t.prototype.update=function(t){const i=t.$trigger.parent(),a=t.$trigger.parent().html(),n={entryId:this.data("entry-id"),userId:t.$trigger.closest("li").data("user-id"),status:t.$trigger.val()};o.set(i,{size:"10px",css:{padding:"0px"}}),c.post(this.data("update-url"),{data:n}).then(function(t){t.success&&(e.success(t.message),o.remove(i),i.html(a).find("select").val(n.status))}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.remove=function(t){const i=t.$trigger.closest("li");var a={entryId:this.data("entry-id"),userId:i.data("user-id")};c.post(this.data("remove-url"),{data:a}).then(function(t){t.success?(e.success(t.message),1===i.closest("ul").find("li[data-user-id]").length&&i.closest("ul").prev("p").show(),i.remove(),l(-1)):e.error(t.message)}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.add=function(t){const n=t.$trigger.closest(".calendar-entry-new-participants-form"),i={entryId:this.data("entry-id"),guids:n.find('select[name="CalendarEntryParticipationForm[newParticipants][]"]').val()},a=n.find('select[name="CalendarEntryParticipationForm[newParticipantStatus]"]');a.length&&(i.status=a.val()),c.post(t,{data:i}).then(function(t){if(t.success){e.success(t.success);const a=n.closest(".calendar-entry-participants").find("#calendar-entry-participants-list ul.media-list");var i=a.find("li").length;a.append(t.html),l(a.find("li").length-i)}else t.warning?e.warn(t.warning):t.error&&e.error(t.error)}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.filterState=function(t){const i=t.$trigger,a=i.parent(),n=r("#globalModal");var e={id:this.data("entry-id"),state:i.data("state")};i.attr("data-active",""),o.set(a,{size:"10px",css:{padding:"0px"}}),c.get(this.data("filter-url"),{data:e}).then(function(t){n.find("#calendar-entry-participants-list").after(t.html).remove(),l(n.find("[name=calendar-entry-participants-count]").val(),!1),o.reset(a),a.find(".btn.active").removeClass("active"),a.find("[data-active]").addClass("active").removeAttr("data-active")}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.changeParticipationMode=function(t){t=0==t.$trigger.val();t?this.$.find(".participationOnly").fadeOut("fast"):this.$.find(".participationOnly").fadeIn("fast"),this.tabParticipants.toggle(!t),this.isNewRecord&&(this.saveButton.toggle(t),this.nextButton.toggle(!t))};const l=function(t,i){const a=r("#globalModal").find(".calendar-entry-participants-count span");a.html(i||void 0===i?parseInt(a.html())+t:t)};t.prototype.next=function(t){this.tabParticipants.find("a").click(),this.nextButton.hide(),this.saveButton.show(),t.finish()},t.prototype.back=function(t){this.tabParticipants.hasClass("active")?(this.tabSettings.find("a").click(),this.saveButton.hide(),this.nextButton.show()):(o.set(t.$trigger,{size:"10px",css:{padding:"0px"}}),a.editModal(t)),t.finish()},s.export=t});