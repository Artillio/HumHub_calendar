humhub.module("calendar.participation.Form",function(s,t,r){const a=t("ui.widget").Widget,c=t("ui.loader"),o=t("client"),n=t("ui.status");t=a.extend();t.prototype.update=function(t){const a=t.$trigger.parent(),e=t.$trigger.parent().html(),i={entryId:this.data("entry-id"),userId:t.$trigger.closest("li").data("user-id"),status:t.$trigger.val()};c.set(a,{size:"10px",css:{padding:"0px"}}),o.post(this.data("update-url"),{data:i}).then(function(t){t.success&&(n.success(t.message),c.remove(a),a.html(e).find("select").val(i.status))}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.remove=function(t){const a=t.$trigger.closest("li");var e={entryId:this.data("entry-id"),userId:a.data("user-id")};o.post(this.data("remove-url"),{data:e}).then(function(t){t.success?(n.success(t.message),1===a.closest("ul").find("li[data-user-id]").length&&a.closest("ul").prev("p").show(),a.remove(),d(-1)):n.error(t.message)}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.add=function(t){const i=t.$trigger.closest(".calendar-entry-new-participants-form"),a={entryId:this.data("entry-id"),guids:i.find('select[name="newParticipants[]"]').val()},e=i.find("select[name=status]");e.length&&(a.status=e.val()),o.post(t,{data:a}).then(function(t){if(t.success){n.success(t.success);const e=i.closest(".calendar-entry-participants").find("#calendar-entry-participants-list ul.media-list");var a=e.find("li").length;e.append(t.html),d(e.find("li").length-a)}else t.warning?n.warn(t.warning):t.error&&n.error(t.error)}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.filterState=function(t){const a=t.$trigger,e=a.parent(),i=r("#globalModal");var n={id:this.data("entry-id"),state:a.data("state")};a.attr("data-active",""),c.set(e,{size:"10px",css:{padding:"0px"}}),o.get(this.data("filter-url"),{data:n}).then(function(t){i.find("#calendar-entry-participants-list").after(t.html).remove(),d(i.find("[name=calendar-entry-participants-count]").val(),!1),c.reset(e),e.find(".btn.active").removeClass("active"),e.find("[data-active]").addClass("active").removeAttr("data-active")}).catch(function(t){s.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.changeParticipationMode=function(t){0==t.$trigger.val()?(this.$.find(".participationOnly").fadeOut("fast"),this.$.find("#calendar-entry-participation-tabs").hide(),this.$.find("#calendar-entry-participation-settings-title").show()):(this.$.find(".participationOnly").fadeIn("fast"),this.$.find("#calendar-entry-participation-tabs").show(),this.$.find("#calendar-entry-participation-settings-title").hide())};const d=function(t,a){const e=r("#globalModal").find(".calendar-entry-participants-count span");e.html(a||void 0===a?parseInt(e.html())+t:t)};s.export=t});