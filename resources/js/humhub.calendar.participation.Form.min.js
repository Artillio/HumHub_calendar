humhub.module("calendar.participation.Form",function(a,t,e){const n=t("ui.widget").Widget,r=t("ui.loader"),s=t("client"),o=t("ui.status");t=n.extend();t.prototype.update=function(t){const i=t.$trigger.parent(),e=t.$trigger.parent().html(),n={entryId:this.data("entry-id"),userId:t.$trigger.closest("li").data("user-id"),status:t.$trigger.val()};r.set(i,{size:"10px",css:{padding:"0px"}}),s.post(this.data("update-url"),{data:n}).then(function(t){t.success&&(o.success(t.message),r.remove(i),i.html(e).find("select").val(n.status))}).catch(function(t){a.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.remove=function(t){const i=t.$trigger.closest("li");var e={entryId:this.data("entry-id"),userId:i.data("user-id")};s.post(this.data("remove-url"),{data:e}).then(function(t){t.success?(o.success(t.message),1===i.closest("ul").find("li[data-user-id]").length&&i.closest("ul").prev("p").show(),i.remove()):o.error(t.message)}).catch(function(t){a.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.displayForm=function(i){const e=this.$.find("ul.media-list");s.get(i).then(function(t){e.append(t.html),n.closest(e.find("li.calendar-entry-new-participants-form:last-child").find("[data-ui-init]")),i.$trigger.remove()}).catch(function(t){a.log.error(t,!0)}).finally(function(){i.finish()})},t.prototype.add=function(t){const i=t.$trigger.closest("li"),e={entryId:this.data("entry-id"),guids:i.find('select[name="newParticipants[]"]').val()},n=i.find("select[name=status]");n.length&&(e.status=n.val()),s.post(t,{data:e}).then(function(t){t.success?(o.success(t.success),i.closest("ul").find("li.calendar-entry-new-participants-form:first").before(t.html).closest("ul").prev("p").hide()):t.warning?o.warn(t.warning):t.error&&o.error(t.error)}).catch(function(t){a.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.filterState=function(t){var i={id:this.data("entry-id"),state:t.$trigger.val()};r.set(t.$trigger.parent(),{size:"10px",css:{padding:"0px"}}),s.get(this.data("filter-url"),{data:i}).then(function(t){e("#globalModal").html(t.html)}).catch(function(t){a.log.error(t,!0)}).finally(function(){t.finish()})},t.prototype.changeParticipationMode=function(t){0==t.$trigger.val()?(this.$.find(".participationOnly").fadeOut("fast"),this.$.find("#calendar-entry-participation-tabs").hide(),this.$.find("#calendar-entry-participation-settings-title").show()):(this.$.find(".participationOnly").fadeIn("fast"),this.$.find("#calendar-entry-participation-tabs").show(),this.$.find("#calendar-entry-participation-settings-title").hide())},a.export=t});